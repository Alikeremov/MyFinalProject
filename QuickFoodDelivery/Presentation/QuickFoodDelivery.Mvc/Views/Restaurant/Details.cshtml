@model DetailVm 
@{
    int count = 1;
    decimal totalprice = 0;
    decimal subtotal = 0;
    int restaurantCount = 1;
}
 <head>
    <link href="~/assets/css/skins/square/grey.css" rel="stylesheet">

    <!-- YOUR CUSTOM CSS -->
    <link href="~/assets/css/custom.css" rel="stylesheet">
    <style>
        .icon_star.active {
            color: yellow; /* veya istediğiniz başka bir renk */
        }
    </style>
 </head>
<!-- SubHeader =============================================== -->
<section data-jarallax class="parallax-window" id="short" data-parallax="scroll" data-image-src="/assets/img/restaurantImages/@Model.Restaurant.Image" data-natural-width="1400" data-natural-height="350">
    <div id="subheader">
        <div id="sub_content">
            <div id="thumb"><img src="~/assets/img/restaurantImages/@Model.Restaurant.Image" style="width:150px; height:150px" alt=""></div>
            <div class="rating" id="rating">
                <!-- Unikal kimlik için yorumun Id'si kullanılıyor -->
                <i class="icon_star"></i>
                <i class="icon_star"></i>
                <i class="icon_star"></i>
                <i class="icon_star"></i>
                <i class="icon_star"></i>
            </div>
            (<small><a href="#0">@Model.Restaurant.Reviews?.Count</a></small>)
            <a asp-action="About" asp-controller="Restaurant" asp-route-id="@Model.Restaurant.Id"><h1>@Model.Restaurant.Name</h1></a>
            <div><em>@Model.Restaurant.Category?.Name</em></div>
            <div><i class="icon_pin"></i> @Model.Restaurant.Address</div>
        </div><!-- End sub_content -->
    </div><!-- End subheader -->
</section><!-- End section -->
<!-- End SubHeader ============================================ -->


<div id="position">
    <div class="container">
        <ul>
            <li><a href="#0">Home</a></li>
            <li><a href="#0">Category</a></li>
            <li>Page active</li>
        </ul>
        <a href="#0" class="search-overlay-menu-btn"><i class="icon-search-6"></i> Search</a>
    </div>
</div><!-- Position -->
<!-- Content ================================================== -->
<div class="container margin_60_35">
    <div class="row">
        <div class="col-lg-3" id="col_left">
            <p><a href="" class="btn_side">Back to search</a></p>
            <div class="box_style_1">
                <ul id="cat_nav">
                    @foreach (var item in Model.FoodCategories)
                    {
                        <li><a asp-action="details" asp-controller="Restaurant" asp-route-foodcategoryId="@item.Id" class="active">@item.Name</a></li>
                    }
                </ul>
            </div><!-- End box_style_1 -->
            <div class="box_style_2 d-none d-sm-block" id="help">
                <i class="icon_lifesaver"></i>
                <h4>Need <span>Help?</span></h4>
                <a href="tel://@Model.Restaurant.Phone" class="phone">@Model.Restaurant.Phone</a>
                <small><span>Opening Time:@Model.Restaurant.OpeningTime?.ToString("HH:mm")</span></small>
                <small><span>Clozing Time:@Model.Restaurant.ClozedTime?.ToString("HH:mm")</span></small>
            </div>
        </div><!-- End col -->
        <div class="col-lg-6">
            <div class="box_style_2" id="main_menu">
                <h2 class="inner">Menu</h2>
                <table class="table table-striped cart-list">
                    <thead>
                        <tr>
                            <th>
                                Item
                            </th>
                            <th>
                                Price
                            </th>
                            <th>
                                Order
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Meals)
                        {
                            <tr>
                                <td>
                                    <figure class="thumb_menu_list"><img src="~/assets/img/mealImages/@item.Image" alt="thumb"></figure>
                                    <h5>@(count++). @item.Name</h5>
                                    <p>
                                        @item.Description
                                    </p>
                                </td>
                                <td>
                                    <strong>€ @item.Price</strong>
                                </td>
                                <td class="options">
                                    <div class="dropdown dropdown-options">
                                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true"><i class="icon_plus_alt2"></i></a>
                                        <div class="dropdown-menu">
                                            <a asp-action="AddBasket" asp-controller="Basket" asp-route-mealid="@item.Id" asp-route-id="@item.RestaurantId" class="add_to_basket">Add to cart</a>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div><!-- End box_style_1 -->
        </div><!-- End col -->
            <div class="col-lg-3" id="sidebar">
                <div class="theiaStickySidebar">
                    <div id="cart_box">
                        <h3>Your order <i class="icon_cart_alt float-right"></i></h3>
        @foreach (var item in Model.BasketItems)
        {
                        totalprice += item.Count * item.Price ;
                        <table class="table table_summary">
                            <tbody>
                                <tr>
                                    <td>
                                        <a asp-action="Remove" asp-controller="Basket" asp-route-mealid="@item.MealId" asp-route-id="@Model.AllMeals.FirstOrDefault(x=>x.Id==item.MealId)?.RestaurantId" class="remove_item"><i class="icon_minus_alt"></i></a> <strong>@item.Count x</strong> @Model.AllMeals.FirstOrDefault(x=>x.Id==item.MealId)?.Name
                                    </td>
                                    <td>
                                        @if (Model.Meals.Any(x => x.RestaurantId != Model.AllMeals.FirstOrDefault(x => x.Id == item.MealId)?.RestaurantId))
                                        {
                                            restaurantCount++;                                          
                                        }
                                        <strong class="float-right">$@(item.Count * item.Price)</strong>
                                       
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <hr>
        }
                        <hr>
                        <table class="table table_summary">
                            <tbody>
                                <tr>
                                    <td>
                                    Delivery fee <span class="float-right">$@(Model.OrderOfRestaurantCount * 10)</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="total">
                                    TOTAL <span class="float-right">$@(totalprice + Model.OrderOfRestaurantCount * 10)</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <hr>
                        <a class="btn_full" asp-action="Checkout" asp-controller="order">Order now</a>
                    </div><!-- End cart_box -->
                </div><!-- End theiaStickySidebar -->
            </div>

            <!-- End col -->
    </div><!-- End row -->
</div><!-- End container -->
<!-- End Content =============================================== -->
<!-- SPECIFIC SCRIPTS -->
<script src="~/assets/js/ResizeSensor.min.js"></script>
<script src="~/assets/js/theia-sticky-sidebar.min.js"></script>
<script>
    jQuery('#sidebar,#col_left').theiaStickySidebar({
      additionalMarginTop: 80
    });
</script>
<!-- SMOOTH SCROLL -->
<script>
    $('#cat_nav a[href^="#"]').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
            || location.hostname == this.hostname) {
            var target = $(this.hash);
            target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
               if (target.length) {
                 $('html,body').animate({
                     scrollTop: target.offset().top -75
                }, 600);
                return false;
            }
        }
    });
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function updateStars(popularity) {
        var stars = $("#rating").find(".icon_star");
        stars.removeClass("active");

        for (var i = 0; i < popularity; i++) {
            $(stars[i]).addClass("active");
        }
    }

    var popularity = @Model.Restaurant.Popularity;

    $(document).ready(function () {
        updateStars(popularity);
    });
</script>